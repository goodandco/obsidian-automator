/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Z=Object.defineProperty;var ht=Object.getOwnPropertyDescriptor;var yt=Object.getOwnPropertyNames;var ft=Object.prototype.hasOwnProperty;var V=(s,n)=>()=>(s&&(n=s(s=0)),n);var F=(s,n)=>{for(var t in n)Z(s,t,{get:n[t],enumerable:!0})},wt=(s,n,t,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of yt(n))!ft.call(s,a)&&a!==t&&Z(s,a,{get:()=>n[a],enumerable:!(e=ht(n,a))||e.enumerable});return s};var Et=s=>wt(Z({},"__esModule",{value:!0}),s);var rt={};F(rt,{CURRENT_SETTINGS_SCHEMA_VERSION:()=>vt,migrateSettings:()=>Pt});function Pt(s){var e,a,i;let n={dimensions:(e=s==null?void 0:s.dimensions)!=null?e:[],projectsRoot:(a=s==null?void 0:s.projectsRoot)!=null?a:"1. Projects",schemaVersion:(i=s==null?void 0:s.schemaVersion)!=null?i:0};if(Array.isArray(n.dimensions)){let o=1;n.dimensions=n.dimensions.map(c=>{var p;if(c&&typeof c=="object"){let l=(p=c.name)!=null?p:"",r=c.order,u=typeof l=="string"?l.match(/^\s*(\d+)\.\s*(.+)$/):null;return u&&(r=parseInt(u[1],10),l=u[2]),(r==null||Number.isNaN(r))&&(r=o++),{name:l,order:r,categories:Array.isArray(c.categories)?c.categories:[]}}return{name:String(c!=null?c:""),order:o++,categories:[]}})}else n.dimensions=[];let t=[...n.dimensions].sort((o,c)=>{var p,l;return((p=o.order)!=null?p:0)-((l=c.order)!=null?l:0)});return t.forEach((o,c)=>{o.order=c+1}),n.dimensions=t,(!n.schemaVersion||n.schemaVersion<2)&&(n.schemaVersion=2),n}var vt,it=V(()=>{vt=2});var ot={};F(ot,{ensureValidOrThrow:()=>kt,validateProjectName:()=>xt,validateTag:()=>At});function xt(s){if(!s||!s.trim())return{ok:!1,reason:"Project name is required"};let n=s.trim();if(n.length>120)return{ok:!1,reason:"Project name too long (max 120)"};for(let t of n)if(t.charCodeAt(0)<32||t==="/"||t==="\\")return{ok:!1,reason:"Project name contains invalid characters"};return{ok:!0}}function At(s){if(!s||!s.trim())return{ok:!1,reason:"Tag is required"};let n=s.trim();return Tt.test(n)?{ok:!0}:{ok:!1,reason:"Tag must be 2-63 chars, start with letter/digit; may include -, _, /"}}function kt(s,n){let t=s();if(!t.ok)throw new Error(`${n}: ${t.reason}`)}var Tt,ct=V(()=>{Tt=/^[A-Za-z0-9][A-Za-z0-9_/-]{1,62}$/});var pt={};F(pt,{processTemplate:()=>$t});function lt(s){return s==null?"":String(s)}function $t(s,n){if(!s||typeof s!="string")return"";let t=s;for(let[e,a]of Object.entries(n)){let i=lt(a),o=`$_${e}`;t.includes(o)&&(t=t.split(o).join(i))}for(let[e,a]of Object.entries(n)){let i=lt(a),o=new RegExp(`\\$\\{${St(e)}\\}`,"g");t=t.replace(o,i)}return t}function St(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var mt=V(()=>{});var X={};F(X,{sanitizeFileName:()=>dt,sanitizePath:()=>Dt});function dt(s){let n=(s!=null?s:"").trim();return Array.from(n).filter(e=>e.charCodeAt(0)>=32).join("").replace(/[\\/:*?"<>|]/g,"-").replace(/\s+/g," ").replace(/\.+$/g,"").substring(0,200)||"untitled"}function Dt(s){return s?s.split("/").filter(Boolean).map(dt).join("/"):""}var Q=V(()=>{});var K={};F(K,{SafeFileManager:()=>tt});var tt,Y=V(()=>{tt=class{constructor(n){this.vault=n.vault}async createBatch(n){let t=[];try{for(let e of n)e.type==="folder"?await this.ensureFolder(e.path):await this.createIfAbsent(e.path,e.data)==="created"&&t.push(e.path);return{ok:!0}}catch(e){for(let a of t.reverse())try{let i=this.vault.getAbstractFileByPath(a);i&&this.vault.delete&&await this.vault.delete(i)}catch(i){}return{ok:!1,error:e}}}async has(n){var t;try{return this.vault.getAbstractFileByPath(n)?!0:(t=this.vault.adapter)!=null&&t.exists?await this.vault.adapter.exists(n):!1}catch(e){return!1}}async ensureFolder(n){var e;if(!this.vault.getAbstractFileByPath(n))try{await this.vault.createFolder(n)}catch(a){if(a&&typeof a=="object"&&((e=a.message)!=null&&e.includes("Parent folder"))){let i=n.split("/").filter(Boolean),o="";for(let c of i)if(o=o?`${o}/${c}`:c,!this.vault.getAbstractFileByPath(o))try{await this.vault.createFolder(o)}catch(p){}}}}async createIfAbsent(n,t){if(await this.has(n))return"skipped";try{return await this.vault.create(n,t),"created"}catch(e){return await this.has(n),"skipped"}}}});var Rt={};F(Rt,{default:()=>_t});module.exports=Et(Rt);var x=require("obsidian");var st=require("obsidian"),U=class extends st.Modal{constructor(t,e,a){super(t);this.prompt=e,this.callback=a}onOpen(){let{contentEl:t}=this;t.createEl("h2",{text:this.prompt});let e=t.createEl("input",{type:"text"});e.focus();let a=t.createEl("button",{text:"Submit"});a.onclick=()=>{let i=e.value.trim();this.close(),this.callback(i||null)}}onClose(){let{contentEl:t}=this;t.empty()}};var nt=require("obsidian"),B=class extends nt.Modal{constructor(t,e,a,i){super(t);this.prompt=e,this.choices=a,this.callback=i}onOpen(){let{contentEl:t}=this;t.createEl("h2",{text:this.prompt}),this.choices.forEach(e=>{let a=t.createEl("button",{text:e});a.onclick=()=>{this.close(),this.callback(e)}})}onClose(){let{contentEl:t}=this;t.empty()}};var b=require("obsidian");var at=require("obsidian"),I=class extends at.Modal{constructor(t,e){super(t);this.onResult=e}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("automator-settings"),t.createEl("p",{text:"Do you want skip settings to defaults? This will override all custom settings."});let e=t.createDiv({cls:"gc-row"});e.createDiv({cls:"gc-spacer"});let a=e.createEl("button",{text:"Yes, use defaults"}),i=e.createEl("button",{text:"Go back"});a.onclick=()=>{this.close(),this.onResult(!0)},i.onclick=()=>{this.close(),this.onResult(!1)}}onClose(){this.contentEl.empty()}};var bt=[{name:"Business",order:1,categories:["R&D","Jobs","OpenSource","Education"]},{name:"Family",order:2,categories:["Vacations","Parenting","Common"]},{name:"Friends",order:3,categories:[]},{name:"Health",order:4,categories:["Clinics","Issues","R&D"]},{name:"Personal",order:5,categories:["R&D","Languages","SelfManagement","Writing","Reading","Music","Sports"]},{name:"Residence",order:6,categories:[]}],H={dimensions:JSON.parse(JSON.stringify(bt)),projectsRoot:"1. Projects"},z=class extends b.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.addClass("automator-settings");let e=t.createDiv({cls:"gc-row"});e.createDiv({cls:"gc-spacer"});let a=e.createEl("button",{cls:["gc-icon-button","clickable-icon"],attr:{"aria-label":"Reset to defaults",title:"Reset to defaults"}});try{(0,b.setIcon)(a,"rotate-ccw")}catch(r){a.setText("Reset to defaults")}a.onclick=()=>{new I(this.app,async u=>{u&&(this.plugin.settings=JSON.parse(JSON.stringify(H)),await this.plugin.saveSettings(),new b.Notice("Settings were reset to defaults."),this.display())}).open()},t.createEl("h2",{text:"Dimensions"}),[...this.plugin.settings.dimensions].sort((r,u)=>{var d,h;return((d=r.order)!=null?d:0)-((h=u.order)!=null?h:0)}).forEach((r,u)=>{let d=t.createDiv({cls:"dimension-setting"}),h=d.createDiv({cls:"dimension-header"});h.addClass("gc-row"),h.createSpan({text:`${r.order}. `});let v=h.createEl("b",{text:r.name});h.createDiv({cls:"gc-spacer"});let A=h.createEl("button",{cls:["gc-icon-button","clickable-icon"]});A.setAttr("aria-label","Move up"),A.setAttr("title","Move up");try{(0,b.setIcon)(A,"arrow-up")}catch(m){A.setText("Up")}A.onclick=async()=>{let f=[...this.plugin.settings.dimensions].filter(E=>{var y,g;return((y=E.order)!=null?y:0)<((g=r.order)!=null?g:0)}).sort((E,y)=>{var g,P;return((g=y.order)!=null?g:0)-((P=E.order)!=null?P:0)})[0];if(!f)return;let w=f.order;f.order=r.order,r.order=w,await this.plugin.saveSettings(),this.display()};let R=h.createEl("button",{cls:["gc-icon-button","clickable-icon"]});R.setAttr("aria-label","Move down"),R.setAttr("title","Move down");try{(0,b.setIcon)(R,"arrow-down")}catch(m){R.setText("Down")}R.onclick=async()=>{let f=[...this.plugin.settings.dimensions].filter(E=>{var y,g;return((y=E.order)!=null?y:0)>((g=r.order)!=null?g:0)}).sort((E,y)=>{var g,P;return((g=E.order)!=null?g:0)-((P=y.order)!=null?P:0)})[0];if(!f)return;let w=f.order;f.order=r.order,r.order=w,await this.plugin.saveSettings(),this.display()};let k=h.createEl("button",{cls:["gc-icon-button","clickable-icon"]});k.setAttr("aria-label",`Delete ${r.name}`),k.setAttr("title",`Delete ${r.name}`);try{(0,b.setIcon)(k,"trash")}catch(m){k.setText("Remove")}k.onclick=async()=>{let m=this.plugin.settings.dimensions.findIndex(f=>f===r);m>=0&&this.plugin.settings.dimensions.splice(m,1),await this.plugin.saveSettings(),this.display()};let $=h.createEl("button",{cls:["gc-icon-button","clickable-icon"]});$.setAttr("aria-label",`Rename ${r.name}`),$.setAttr("title",`Rename ${r.name}`);try{(0,b.setIcon)($,"pencil")}catch(m){$.setText("Edit")}if($.onclick=async()=>{var M;let m=r.name,f=v.parentElement;(M=v.detach)==null||M.call(v),$.style.display="none",k.style.display="none";let w=f.createEl("input",{type:"text"});w.value=m,w.addClass("gc-rename");let E=f.createDiv({cls:"gc-row"});E.createDiv({cls:"gc-spacer"});let y=E.createEl("button",{cls:["gc-icon-button","clickable-icon"]});y.setAttr("aria-label","Apply"),y.setAttr("title","Apply");try{(0,b.setIcon)(y,"check")}catch(T){y.setText("Apply")}let g=E.createEl("button",{cls:["gc-icon-button","clickable-icon"]});g.setAttr("aria-label","Discard"),g.setAttr("title","Discard");try{(0,b.setIcon)(g,"x")}catch(T){g.setText("Discard")}let P=()=>{this.display()},S=async T=>{let D=T.trim();if(!D||D===m){P();return}if(this.plugin.settings.dimensions.some(_=>_!==r&&_.name===D)){new b.Notice("A dimension with this name already exists.");return}r.name=D,await this.plugin.saveSettings(),P()};y.onclick=async()=>{await S(w.value)},g.onclick=()=>P(),w.focus(),w.select(),w.onkeydown=async T=>{T.key==="Enter"&&await S(w.value),T.key==="Escape"&&P()},w.onblur=async()=>{await S(w.value)}},r.categories.length>0){let m=d.createDiv({cls:"categories-list gc-list"});r.categories.forEach((f,w)=>{let E=m.createDiv({cls:"gc-list-item gc-row"}),y=E.createSpan({text:f});E.createDiv({cls:"gc-spacer"});let g=E.createEl("button",{cls:["remove-category","gc-icon-button","clickable-icon"]});g.setAttr("aria-label",`Delete ${f}`),g.setAttr("title",`Delete ${f}`);try{(0,b.setIcon)(g,"trash")}catch(S){g.setText("Remove")}g.onclick=async()=>{r.categories.splice(w,1),await this.plugin.saveSettings(),this.display()};let P=E.createEl("button",{cls:["gc-icon-button","clickable-icon"]});P.setAttr("aria-label",`Rename ${f}`),P.setAttr("title",`Rename ${f}`);try{(0,b.setIcon)(P,"pencil")}catch(S){P.setText("Edit")}P.onclick=async()=>{var et;let S=r.categories[w],M=y.parentElement;(et=y.detach)==null||et.call(y),P.style.display="none",g.style.display="none";let T=M.createEl("input",{type:"text"});T.value=S,T.addClass("gc-rename");let D=M.createDiv({cls:"gc-row"});D.createDiv({cls:"gc-spacer"});let _=D.createEl("button",{cls:["gc-icon-button","clickable-icon"]});_.setAttr("aria-label","Apply"),_.setAttr("title","Apply");try{(0,b.setIcon)(_,"check")}catch(C){_.setText("Apply")}let O=D.createEl("button",{cls:["gc-icon-button","clickable-icon"]});O.setAttr("aria-label","Discard"),O.setAttr("title","Discard");try{(0,b.setIcon)(O,"x")}catch(C){O.setText("Discard")}let G=()=>{this.display()},q=async C=>{let L=C.trim();if(!L||L===S){G();return}if(r.categories.some((gt,ut)=>ut!==w&&gt===L)){new b.Notice("This category already exists in the dimension.");return}r.categories[w]=L,await this.plugin.saveSettings(),G()};_.onclick=async()=>{await q(T.value)},O.onclick=()=>G(),T.focus(),T.select(),T.onkeydown=async C=>{C.key==="Enter"&&await q(T.value),C.key==="Escape"&&G()},T.onblur=async()=>{await q(T.value)}}})}let j=d.createDiv({cls:"add-category gc-row"}),J=j.createEl("input",{type:"text",placeholder:"New category"});j.createDiv({cls:"gc-spacer"});let N=j.createEl("button",{text:"Add Category"});N.onclick=async()=>{let m=J.value.trim();m&&!r.categories.includes(m)&&(r.categories.push(m),await this.plugin.saveSettings(),this.display())}});let o=t.createDiv({cls:"add-dimension"});o.createEl("h3",{text:"Add new dimension"});let c=o.createDiv({cls:"gc-row"}),p=c.createEl("input",{type:"text",placeholder:"Dimension name"});c.createDiv({cls:"gc-spacer"});let l=c.createEl("button",{text:"Add Dimension"});l.onclick=async()=>{let r=p.value.trim();if(r&&!this.plugin.settings.dimensions.some(u=>u.name===r)){{let u=this.plugin.settings.dimensions.reduce((d,h)=>{var v;return Math.max(d,(v=h.order)!=null?v:0)},0);this.plugin.settings.dimensions.push({name:r,order:u+1,categories:[]})}await this.plugin.saveSettings(),this.display()}}}};var W=class extends x.Plugin{async onload(){console.log("ProjectFlow plugin loaded"),await this.loadSettings(),this.addSettingTab(new z(this.app,this)),this.addCommand({id:"add-project-info",name:"Add Project Info",callback:()=>this.showProjectPrompt()})}async loadSettings(){let t=await this.loadData();try{let{migrateSettings:e}=await Promise.resolve().then(()=>(it(),rt));this.settings=Object.assign({},H,e(t))}catch(e){this.settings=Object.assign({},H,t)}}async saveSettings(){await this.saveData(this.settings)}async showProjectPrompt(){let t=await this.promptForText("Enter project name:");if(!t){new x.Notice("Project creation cancelled. No project name provided.");return}let e=await this.promptForText("Enter project tag:");if(!e){new x.Notice("Project creation cancelled. No project tag provided.");return}let a=await this.promptForText("Enter parent name (optional):"),i=a&&a.trim().length>0?a.trim():null,o=[...this.settings.dimensions].sort((d,h)=>{var v,A;return((v=d.order)!=null?v:0)-((A=h.order)!=null?A:0)}).map(d=>d.name),c=await this.promptForChoice("Select dimension:",o);if(!c){new x.Notice("Project creation cancelled. No dimension selected.");return}let p=this.settings.dimensions.find(d=>d.name===c);if(!p||p.categories.length===0){new x.Notice("Selected dimension has no categories. Please add categories in settings first.");return}let l=p.categories,r=await this.promptForChoice("Select category:",l);if(!r){new x.Notice("Project creation cancelled. No category selected.");return}let u={name:t,tag:e,parent:i,dimension:c,category:r};try{let{validateProjectName:d,validateTag:h,ensureValidOrThrow:v}=await Promise.resolve().then(()=>(ct(),ot));v(()=>d(u.name),"Invalid project name"),v(()=>h(u.tag),"Invalid tag")}catch(d){let h=d.message||"Invalid input";console.error("Validation error:",d),new x.Notice(h);return}await this.createProject(u)}async promptForText(t){return new Promise(e=>{new U(this.app,t,e).open()})}async promptForChoice(t,e){return new Promise(a=>{new B(this.app,t,e,a).open()})}generateProjectVariables(t){let e=new Date,a=e.getFullYear().toString(),i=e.toISOString().split("T")[0],o=this.settings.projectsRoot||"1. Projects",c=t.parent&&t.parent.trim().length>0?`.${t.parent.trim()}`:"",p=`${a}${c}.${t.name}`,l=this.settings.dimensions.find(h=>h.name===t.dimension),r=l?`${l.order}. ${l.name}`:t.dimension,u=`${o}/${r}/${t.category}/${p}`,d=`${u}`;return{PROJECT_NAME:t.name,PROJECT_TAG:t.tag,PROJECT_PARENT:t.parent?t.parent:"",PARENT_TAG:t.parent?t.tag:"",YEAR:a,DATE:i,PROJECT_FULL_NAME:p,PROJECT_RELATIVE_PATH:u,PROJECT_PATH:d,DIMENSION:l?l.name:t.dimension,CATEGORY:t.category,PROJECT_DIMENSION:l?l.name:t.dimension}}async processTemplate(t,e){try{let{processTemplate:a}=await Promise.resolve().then(()=>(mt(),pt));return a(t,e)}catch(a){console.warn("Template processor import failed, using legacy replacement:",a);let i=t;return Object.entries(e).forEach(([o,c])=>{let p=`$_${o}`;i=i.split(p).join(c)}),i}}async createProject(t){try{let e=this.generateProjectVariables(t),a=this.settings.projectsRoot||"1. Projects",{sanitizePath:i,sanitizeFileName:o}=await Promise.resolve().then(()=>(Q(),X)),{SafeFileManager:c}=await Promise.resolve().then(()=>(Y(),K)),p=new c(this.app),l=i(a),r=this.settings.dimensions.find(m=>m.name===t.dimension),u=r?`${r.order}. ${r.name}`:t.dimension,d=o(u),h=o(t.category),v=i(`${l}/${d}/${h}/${e.PROJECT_FULL_NAME}`),R=[{type:"folder",path:v},...["Knowledge Base","Meetings","Work","People"].map(m=>({type:"folder",path:i(`${v}/${m}`)}))],k=this.app.vault.adapter,$=`.obsidian/plugins/${this.manifest.id}/src/templates`,j=[{fileName:`${e.PROJECT_FULL_NAME}.md`,template:"project.md"},{fileName:`${t.name} Meetings.md`,template:"meetings.md"},{fileName:`${t.name} People.md`,template:"people.md"},{fileName:`${t.name} Work.md`,template:"work.md"}],J=[];for(let m of j){let f=`${$}/${m.template}`;if(!await k.exists(f))throw new Error(`Template file not found: ${m.template}`);let w=await k.read(f),E=await this.processTemplate(w,e),y=i(`${v}/${o(m.fileName)}`);J.push({type:"file",path:y,data:E})}let N=await p.createBatch([...R,...J]);if(!("ok"in N)||!N.ok)throw new Error(`Batch creation failed: ${N.error||"unknown"}`);await this.createProjectTemplates(t.name,e),new x.Notice(`Project "${t.name}" created successfully!`)}catch(e){new x.Notice(`Error creating project: ${e}`),console.error("Project creation error:",e)}}async ensureDirectoryExists(t){let{SafeFileManager:e}=await Promise.resolve().then(()=>(Y(),K));await new e(this.app).ensureFolder(t)}async createProjectFile(t,e,a,i){try{let o=this.app.vault.adapter,c=`.obsidian/plugins/${this.manifest.id}/src/templates/${a}`;if(console.log("Template: "+c),!await o.exists(c))throw new Error(`Template file not found: ${a}`);let p=await this.app.vault.adapter.read(c),l=await this.processTemplate(p,i),r=`${t}/${e}`,{SafeFileManager:u}=await Promise.resolve().then(()=>(Y(),K));await new u(this.app).createIfAbsent(r,l)}catch(o){throw console.error(`Failed to create ${e}:`,o),new Error(`Failed to create ${e}: ${o}`)}}async createProjectTemplates(t,e){let{sanitizePath:a,sanitizeFileName:i}=await Promise.resolve().then(()=>(Q(),X)),o=a(`Templates/${t}_Templates`);await this.ensureDirectoryExists(o);let c=[{source:"template-meeting-daily.md",target:`${t}_Meeting_Daily_Template.md`},{source:"template-meeting-discussion.md",target:`${t}_Meeting_Discussion_Template.md`},{source:"template-meeting-knowledge.md",target:`${t}_Meeting_Knowledge_Template.md`},{source:"template-meeting-planning.md",target:`${t}_Meeting_Planning_Template.md`},{source:"template-meeting-refinement.md",target:`${t}_Meeting_Refinement_Template.md`},{source:"template-meeting-retro.md",target:`${t}_Meeting_Retro_Template.md`},{source:"template-meeting-demo.md",target:`${t}_Meeting_Demo_Template.md`},{source:"template-sprint.md",target:`${t}_Sprint_Template.md`},{source:"template-task.md",target:`${t}_Task_Template.md`},{source:"template-idea.md",target:`${t}_Idea_Template.md`}];for(let p of c)try{let l=i(p.target);await this.createProjectFile(o,l,p.source,e)}catch(l){console.warn(`Failed to create template ${p.target}: ${l}`)}}};var _t=W;
