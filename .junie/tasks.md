# Implementation Tasks for ProjectFlow Plugin (Aligned with Final Design)

Date: 2025-09-29

This plan aligns with final_design.md (Version 2.0 – Finalized Design). It emphasizes minimal, non‑breaking steps first, preserves current build/runtime behavior, and defines a clear phased path.

---

## Phase 1 — Minimal, Non‑Breaking Improvements (Immediate)

### Task 1.1: Extract Pure Helpers (No runtime renames)
Priority: Critical  
Estimated Time: 4–6 hours
- [x] Create `src/core/template-processor.ts` with dual token support: replace `${VAR}` and legacy `$_VAR`.
- [x] Create `src/core/variable-generator.ts` for generating project variables used by the plugin.
- [x] Export functions so existing plugin code (e.g., plugin.ts/AutomatorPlugin) can import without architectural churn.

### Task 1.2: Minimal SafeFileManager
Priority: High  
Estimated Time: 2–3 hours
- [x] Create `src/services/file-manager.ts` with:
  - `has(path): Promise<boolean>`
  - `ensureFolder(path): Promise<void>`
  - `createIfAbsent(path, data): Promise<'created'|'skipped'>` (skip on conflict; do not throw).
- [x] Integrate in creation paths where feasible without breaking behavior.

### Task 1.3: projectsRoot Setting
Priority: High  
Estimated Time: 1–2 hours
- [x] Add `projectsRoot` to settings (default: "1. Projects").
- [x] Use this setting when constructing project paths.
- [x] Defer adding UI control if needed; default keeps behavior unchanged.

### Task 1.4: Documentation Updates (Immediate)
Priority: Medium  
Estimated Time: 1–2 hours
- [x] Update README: clarify template directory inside vault (`.obsidian/plugins/<id>/src/templates/*.md`) and dual token support.
- [x] Add Troubleshooting note: missing template files cause "Template file not found"; ensure directories exist.

---

## Phase 2 — Enhanced Safety and Structure

### Task 2.1: Safe Batches and Rollback
Priority: High  
Estimated Time: 4–6 hours
- [x] Extend SafeFileManager with batched create operations and partial rollback on failures.

### Task 2.2: Validation and Sanitization
Priority: High  
Estimated Time: 4–5 hours
- [x] Add `InputValidator` for names/tags (e.g., `validateProjectName`, `validateTag`).
- [x] Add `PathSanitizer` (`sanitizeFileName`, `sanitizePath`).

### Task 2.3: Gradual Structure Consolidation
Priority: Medium  
Estimated Time: 4–6 hours
- [x] Begin moving logic toward `src/core` and `src/services` folders; update imports incrementally.
- [x] Keep runtime filenames and public API stable.

### Task 2.4: Settings Schema (Lightweight)
Priority: Medium  
Estimated Time: 3–4 hours
- [x] Introduce settings schema version and minimal migration utility.

---

## Phase 3 — Developer Experience & Testing

### Task 3.1: Build Verification Script
Priority: High  
Estimated Time: 0.5–1 hour
- [x] Add `scripts/build.test.mjs` that runs `npm run build`, checks `main.js` exists, size > 1000 bytes, and contains the banner "THIS IS A GENERATED/BUNDLED FILE BY ESBUILD".
- [x] Run via `node scripts/build.test.mjs`.

### Task 3.2: Optional Unit Tests for Pure Helpers
Priority: Medium  
Estimated Time: 4–6 hours
- [x] Add a lightweight test setup (e.g., Vitest) for `template-processor` and `variable-generator` only (no `obsidian` import).

### Task 3.3: Linting (Optional)
Priority: Low  
Estimated Time: 2–3 hours
- [x] Add ESLint and basic scripts if desired.

---

## Phase 4 — Cleanup and Renames

Priority: Low  
Estimated Time: 2–4 hours
- [x] Consider renaming `choise-modal.ts` → `choice-modal.ts` with export alias/backward compatibility.
- [x] Normalize template names/labels and update docs.

---

## Acceptance & Validation
- [x] `npm run build` succeeds; bundled `main.js` contains the esbuild banner.
- [x] `final_design.md` present at repo root and reflects reconciled plan.
- [x] Phase 1 changes do not break existing user workflows; Obsidian externals remain externalized.

---

## Summary
- Immediate focus: dual token template processor, variable generator, minimal SafeFileManager, projectsRoot setting, README notes.  
- Subsequent phases: safety improvements, validation/sanitization, developer experience, and cleanup.

---


## Phase 5 - Change requests & Bugfixes



### Task 5.1: Bugfixes

- [x] The errors must be printed in the console. 
- [x] There is $_PROJECT_DIMENSION variable in the templates which hasn't handled and replaced with selected dimension. Fix it and update the code.
- [x] It must allows underscores (_), hyphens (-), and forward slashes (/) for nesting for tags. Please update validation rules for tags.

### Task 5.2: Change request - dimension ordering in settings

- [x] Add ordering of the dimensions in the settings. 
      User the order number for path calculation.
      Now, it is now by adding order numbers to the dimension names in the config. 
      So, update that with proper orders. 
- [x] For dimension variable use the value without order number.

### Task 5.3: Update README.md 

- [x] WIth all the changes we've done recently please update README.md. 
      Also, consider that the audience of README is obsidian users who wants to use this current project as a plugin.
      
### Task 5.4: Script to Build and COpy Files to Obsidian Vault

- [x] Create a script for building and copying built files to the some particular obsidian vault. Something like:
`cp -f main.js /Users/<user>/path/to/MyVault/.obsidian/plugins/project-flow`
So, it should be run as npm run command. Then it must prompt path of the vault and manage all the stuff.
